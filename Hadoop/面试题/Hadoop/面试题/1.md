### Hadoop的checkpoint流程

可回答：1）fsimage 和 edit 的区别？

问过的一些公司：唯品会社招(2021.08)，头条(2018.11)，网易(2018.09)

参考答案：

![image-20210920162807599](https://raw.githubusercontent.com/qiye0716/picture_typora/main/Hadoop/202304051416947.png)

在hdfs-site.xml文件指定Secondary NameNode部署在哪个机器上。

**当记录条数超过100w条，或者时间超过3600s（1小时），Secondary NameNode提醒NameNode做Checkpoint。**

**步骤如下：**

1）Secondary NameNode提醒NameNode开始做Checkpoint；

2）NameNode上的edit_inprogress文件滚动生成edit_sum文件；

3）edit_inprogress滚动生成edit文件，将滚动前的编辑日志edit和镜像文件fsimage拷贝到Secondary NameNode；

4）Secondary NameNode加载编辑日志和镜像文件到内存并合并；

5）生成新的镜像文件fsimage.chkpoint，拷贝fsimage.chkpoint到NameNode，NameNode将fsimage.chkpoint重新命名成fsimage。

**详细版本**

![image-20210920163128911](https://raw.githubusercontent.com/qiye0716/picture_typora/main/Hadoop/202304051416849.png)

**FsImage :**

元数据序列化后在磁盘存储的地方。包含HDFS文件系统的所有目录跟文件inode序列化信息。

**Memory：**

元数据在内存中存储的地方。

**Edit文件：**

1）Edit 记录客户端更新元数据信息的每一步操作（可通过Edits运算出元数据）。

2）一旦元数据有更新跟添加，元数据修改追加到Edits中然后修改内存中的元数据，这样一旦NameNode 节点断电，通过 FsImage 跟 Edits 的合并生成元数据。

3）Edits文件不要过大，系统会定期的由 Secondary Namenode 完成 FsImage 和 Edits 的合并。
